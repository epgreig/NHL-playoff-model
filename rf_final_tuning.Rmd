---
title: "rf_final_tuning.Rmd"
author: "Ethan Greig"
date: "1/27/2019"
output: html_document
---

```{r, include=FALSE}
library(knitr)
source(purl('random_forest_tuning.Rmd', output = tempfile()))
source(purl('cross_validation.Rmd', output = tempfile()))
source(purl('rf_feature_selection.Rmd', output = tempfile()))
```

## Define subsets of full features
```{r}
df_10 <- df[,c('Home_Won', dStats_10)]
df_5 <- df[,c('Home_Won', dStats_5)]
df_4 <- df[,c('Home_Won', dStats_4)]
```

## Hyperparameter Tuning on reduced feature set RF (10 features)
```{r}
# Grid Search using randomForest's built in OOB error (not cross-validated Log Loss).
# Prioritize lower mtry (less correlation btw trees) and higher nodesize (smoothing out regression)

# Grids attempted:
#rf_grid(df_10, mtrys=1:2, nodesizes=30:100, ntrees=5000)
rf_grid(df_10, mtrys=1, nodesizes=48:65, ntrees=30000)

# result: mtry=1, nodesize=62
```

## Hyperparameter Tuning on reduced feature set RF (4 best features)
```{r}
# Grid Search using randomForest's built in OOB error (not cross-validated Log Loss)
# Prioritize lower mtry (less correlation btw trees) and higher nodesize (smoothing out regression)

# Grids attempted:
#rf_grid(df_4, mtrys=1:2, nodesizes=20:100, ntrees=5000)
rf_grid(df_4, mtrys=1, nodesizes=40:80, ntrees=10000)

# result: mtry=1, nodesize=60
```

## Hyperparameter Tuning on test feature set RF (5 test features)
```{r}
# Grid Search using randomForest's built in OOB error (not cross-validated Log Loss)
# Prioritize lower mtry (less correlation btw trees) and higher nodesize (smoothing votes)

# Grids attempted:
rf_grid(df_5, mtrys=1, nodesizes=35:175, ntrees=4000)
#rf_grid(df_5, mtrys=1, nodesizes=70:90, ntrees=500000)

# result: mtry=1, nodesize=73
```

## Random Forest (Regression) Performance, Tuned on subsets of features
```{r} 
cv_rf_reg(df_10, nfolds=11, nruns=32, mtry=1, nodesize=62, ntrees=8000, symm=FALSE)
# Log Loss: 0.643 (sd 0.07)
# Accuracy: 66%
cv_rf_reg(df_10, nfolds=11, nruns=32, mtry=1, nodesize=62, ntrees=8000, symm=TRUE)
# Log Loss: 0.627 (sd 0.07)
# Accuracy: 69%

cv_rf_reg(df_4, nfolds=11, nruns=32, mtry=1, nodesize=60, ntrees=8000, symm=FALSE)
# Log Loss: 0.633 (sd 0.08)
# Accuracy: 66%
cv_rf_reg(df_4, nfolds=11, nruns=32, mtry=1, nodesize=60, ntrees=8000, symm=TRUE)
# Log Loss: 0.622 (sd 0.09)
# Accuracy: 67%

cv_rf_reg(df_5, nfolds=11, nruns=32, mtry=1, nodesize=73, ntrees=8000, symm=FALSE)
# Log Loss: 0.633 (sd 0.07)
# Accuracy: 67%
cv_rf_reg(df_5, nfolds=11, nruns=84, mtry=1, nodesize=44, ntrees=10000, symm=TRUE)
# Log Loss: 0.619 (sd 0.08)
# Accuracy: 68%
```

